<meta name="viewport" content="width=device-width, initial-scale=1.0">

<%- include('../blocks/header', {bot, user, path}) %>
<div class="container">

	<div class="row justify-content-md-center">
		<div align="center"><h2 style="color: #fff;"><i class="fa fa-wrench fa-fw" aria-hidden="true"></i> Gelişmiş Davet Sistemi</h2></div>
  </div>
	
  <!--<center><h7 style="color:red">Bakımda...</h7></center>-->
  
	<div class="row">
    
<div class="col">
    <div class="container">
      <form method="post">
        <ul class="list-group list-group-flush">
          
            <div class="row">
            <div class="col-25">
              <label for="davetK">Davet Kayıtları Kanalı</label>
            </div>
            <div class="col-75">
              <select id="davetK" name="davetK"> 
           <%if(bot.ayar.has(`davetK_${guild.id}`) === false) {%>
                <option value="" disabled selected>Kanal seçiniz.</option>
                <%for (var i = 0; i < guild.channels.filter(c => c.type==='text').size; i++){%>
               
                <option value="<%=guild.channels.filter(c => c.type==='text').array()[i].name%>">#<%=guild.channels.filter(c => c.type==='text').array()[i].name%></option>
              <%  } %>
           <%} else {%>
               <option value="<%=guild.channels.get(bot.ayar.fetch(`davetK_${guild.id}`)).name%>" selected>#<%=guild.channels.get(bot.ayar.fetch(`davetK_${guild.id}`)).name%></option>
              <%for (var i = 0; i < guild.channels.filter(c=>c.id!==bot.ayar.fetch(`davetK_${guild.id}`)).filter(c => c.type==='text').size; i++){%>
               
                <option value="<%=guild.channels.filter(c=>c.id!==bot.ayar.fetch(`davetK_${guild.id}`)).filter(c => c.type==='text').array()[i].name%>">#<%=guild.channels.filter(c=>c.id!==bot.ayar.fetch(`davetK_${guild.id}`)).filter(c => c.type==='text').array()[i].name%></option>
              <%  } %>
                <%}%>
              </select>
            </div>
          </div>
          <% let db = bot.ayar %>
          <div class="row">
            <div class="col-25">
              <label for="davetRol">Davet Rol Ödülü</label>
            </div>
            <div class="col-75">
              <select id="davetRol" name="davetRol" style="width: 49%"> 
                 <option value="" disabled selected>Rol seçiniz.</option>
                <%
                for (var i = 0; i < guild.roles.filter(r=> r.name!=='@everyone').size; i++){%>
              
                <option value="<%=guild.roles.filter(r=> r.name!=='@everyone').array()[i].name%>">@<%=guild.roles.filter(r=> r.name!=='@everyone').array()[i].name%></option>
              <%  } %>
              </select>
              
								<input type="number" style="width: 49%; text-align: left; float: right;" name="davetSayi" id="davetSayi"
									placeholder="Bir sayı yazınız!">
            </div>
           <center><p align="center" style="color:#fff">
              Davet rol ödülü sistemine birden çok eklenebilmektedir o yüzden kaydedince gözükmez.
             </p></center>
          </div>
          
          <br>
        <h3 align="center" style="color:#fff">
         Davet Liderliği
      </h3>
        <br>
        <table class="table table-hover" style="background-color:#222">
            <thead>
                <tr>
                  <th scope="col" style="width: 25%">Kullanıcı</th>
                    <th scope="col" style="width: 50%">Davet Sayısı</th>
                    <th scope="col" style="width: 25%"></th>
                </tr>
            </thead>
            <tbody>
              <%
             guild.fetchInvites().then(i=>{
let sort = guild.members.filter(m => !m.user.bot).array().sort((a, b) => {return i.filter(d => d.inviter.id === b.user.id).size - i.filter(d => d.inviter.id === a.user.id).size})
let top = sort.splice(0, 10)
let sira = 1
let size = i
let mapName = top.map(i => i.user.tag)
let mapID = top.map(i => i.user.id)

%>
              <% for(var ii = 0; ii < 10; ii++) { %>           
              <tr>
                  <th scope="row"><%=mapName[ii]%></th>
                  <td><%=size.filter(d => d.inviter.id === mapID[ii]).size%></td>
                 </tr>
                <%}%>
              <%})%>
            </tbody>
        </table>
          
          </ul>
          <div style="width: 100%; text-align: right; margin-top: 15px;">
    <button style="background-color:blue; color:#fff" type="sumbit" id="formbtn" class="btn btn-default"><i class="fa fa-fw fa-save" aria-hidden="true"></i> Kaydet</button>
          </div>
      </form>
    </div>
  </div>
    
</div>
<% include ../blocks/guild-modals %>

<script>
	var ts = parseInt($('#guildCreate').text());
	$('#guildCreate').html(`<strong>Created:</strong>: ${moment(ts).format('MMMM Do YYYY (h:mm a)')}`);  
</script>
<% include ../blocks/footer %>
